<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.836d044100531021daee.css","/main.6ce7aa9963deee7ee6a8.js"],"component---theme-blog-post-pageccc-cab":["/component---theme-blog-post-pageccc-cab.42d18faa279882580cbb.css","/component---theme-blog-post-pageccc-cab.f1186a1edfdf501c30c8.js"],"content---blog-dive-deep-into-astf-57-511":["/content---blog-dive-deep-into-astf-57-511.f40fb3bf39b4faf028f1.js"],"metadata---blog-dive-deep-into-astdcf-78c":["/metadata---blog-dive-deep-into-astdcf-78c.ef3efba524e487d5fa12.js"],"nextItem---blog-dive-deep-into-asteef-c4b":["/nextItem---blog-dive-deep-into-asteef-c4b.7736a0a4a4ba9c8c78eb.js"],"content---blog-git-internalse-44-e34":["/content---blog-git-internalse-44-e34.3c82f465f6872ef80b5c.js"],"component---theme-blog-list-pagea-6-a-7ba":["/component---theme-blog-list-pagea-6-a-7ba.42d18faa279882580cbb.css","/component---theme-blog-list-pagea-6-a-7ba.222c816c794f2bf0f110.js"],"content---blogd-83-12b":["/content---blogd-83-12b.9c38ba13abdacda89aba.js"],"content---blog-182-9c5":["/content---blog-182-9c5.42bea71e00ec6c6ab5d5.js"],"metadata---blog-1-a-9-d63":["/metadata---blog-1-a-9-d63.4679278f388f6b599a22.js"],"component---theme-doc-page-1-be-9be":["/component---theme-doc-page-1-be-9be.a7dc664af81736e8f518.css","/component---theme-doc-page-1-be-9be.ef3ebb8014acb6644709.js"],"docsMetadata---docs-1-da-721":["/docsMetadata---docs-1-da-721.03a16053328592c69b37.js"],"component---theme-doc-item-178-a40":["/component---theme-doc-item-178-a40.de2648345892298aff25.css","/component---theme-doc-item-178-a40.01a6bae5125d92f69a9a.js"],"content---docs-doc-1-b-2-f-e80":["/content---docs-doc-1-b-2-f-e80.351a4cfeba5e01303223.js"],"metadata---docs-doc-1456-c0d":["/metadata---docs-doc-1456-c0d.772ee8dbb3baf22cf75d.js"],"content---docs-doc-2-df-3-eaa":["/content---docs-doc-2-df-3-eaa.d94442907ef3b00be6b5.js"],"metadata---docs-doc-2-bac-827":["/metadata---docs-doc-2-bac-827.fe2749e30f96e4f10646.js"],"content---docs-doc-3616-40c":["/content---docs-doc-3616-40c.e92f452d504c0bc355a6.js"],"metadata---docs-doc-3958-524":["/metadata---docs-doc-3958-524.b54fd65e0c16095e36d8.js"],"content---docs-mdxce-3-7d1":["/content---docs-mdxce-3-7d1.17d5f9b02966db379fea.js"],"metadata---docs-mdx-514-01a":["/metadata---docs-mdx-514-01a.56e5986200dfe0ce85c6.js"],"component---theme-blog-tags-posts-page-687-b6c":["/component---theme-blog-tags-posts-page-687-b6c.42d18faa279882580cbb.css","/component---theme-blog-tags-posts-page-687-b6c.b77235e0c9a5d4130527.js"],"metadata---blog-tags-ast-428-da2":["/metadata---blog-tags-ast-428-da2.4a6e1638b51ec512cdd5.js"],"metadata---blog-tags-internalsa-02-401":["/metadata---blog-tags-internalsa-02-401.c8a8537b70d55324562f.js"],"metadata---blog-tags-git-569-47e":["/metadata---blog-tags-git-569-47e.fc26f5851032763182fb.js"],"component---theme-blog-tags-list-page-01-a-d0b":["/component---theme-blog-tags-list-page-01-a-d0b.4fb0941ca83ee2d84137.js"],"tags---blog-tagsba-6-d64":["/tags---blog-tagsba-6-d64.4db9fd442cdcec470727.js"]};/*]]>*/</script>

<title data-react-helmet="true">Git Internals</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="Git Internals"/><meta data-react-helmet="true" name="description" content="![alt-text](/assets/git-internals/header.jpeg)"/><meta data-react-helmet="true" property="og:description" content="![alt-text](/assets/git-internals/header.jpeg)"/><meta data-react-helmet="true" name="twitter:card" content="summary"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"/>


<link rel="stylesheet" type="text/css" href="/main.836d044100531021daee.css" />

<link rel="stylesheet" type="text/css" href="/common.beb5263729d2db16c046.css" />

<link rel="stylesheet" type="text/css" href="/1.2d0cefca6f8bbc3f601c.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-blog-post-pageccc-cab.42d18faa279882580cbb.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo"/></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vC moon_1N64"></span></div><div class="react-toggle-track-x"><span class="toggle_16vC sun_3CZP"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo"/></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><main class="main"><div class="container margin-vert--xl"><div class="row"><div class="col col--8 col--offset-2"><div><header><h1 class="margin-bottom--sm blogPostTitle_2RZH"><a aria-current="page" class="active" href="/blog/git-internals">Git Internals</a></h1><div class="margin-bottom--sm"><small>January<!-- --> <!-- -->17<!-- -->, <!-- -->2019</small></div><div class="avatar margin-bottom--md"><a class="avatar__photo-link" href="https://github.com/zoharyzgiaev" target="_blank" rel="noreferrer noopener"><img class="avatar__photo" src="https://avatars1.githubusercontent.com/u/43813108?s=460&amp;v=4" alt="Zohar Yzgeav"/></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/zoharyzgiaev" target="_blank" rel="noreferrer noopener">Zohar Yzgeav</a></h4><small class="avatar__subtitle">Code Enthusiast</small></div></div></header><article class="markdown"><p><img src="/assets/git-internals/header.jpeg" alt="alt-text"/></p><p>Who doesn’t know Git? Most of us are probably using Git or some other source control tool in our everyday life. In this article I will explain how Git works behind the scenes, we’ll dive into the HEAD file, how different Git flow commands work and will explore different Git terminologies. This knowledge will not only improve our Git capabilities but will also introduce deep understanding which will help us build different products in our future career.</p><p>In this article I assume you have basic understanding of what Git is, how is it different from other source control tools and that you have used basic git before.</p><p><strong>Disclaimer</strong>: This article is intended for people who want to expand their knowledge in ‘git-internals’ which is a wide topic to understand Git behind the scenes, you won’t learn how to use different git command in this article but rather how they work.</p><h3><a aria-hidden="true" class="anchor" id="it-all-starts-from-the-basics"></a><a aria-hidden="true" class="hash-link" href="#it-all-starts-from-the-basics">#</a>It all starts from the basics</h3><p><img src="/assets/git-internals/push-meme.png" alt="alt-text"/></p><p>In order to start hacking with Git we will need to use the
git init
command which will create a local repository for us.
This command created a hidden folder with the name of .git which represents the whole repository. From now on, every Git command we will use will be affected by the hidden .git folder that has been just created.</p><p><img src="/assets/git-internals/git-01.png" alt="contents of the hidden .git folder"/></p><p>Let’s dive into the contents of the .git folder, this folder contains different folders <!-- -->&amp;<!-- --> files which responsible for managing your repository:</p><ul><li><p>Objects directory — A folder that lists all the files history, we will talk briefly about this directory soon.</p></li><li><p>Hooks directory — A folder that contains hook scripts that can be run before/after different Git commands.</p></li><li><p>Info directory — A folder that contains the exclude file which is responsible for IDE changes, this file is similar to .gitignore but it doesn’t intended for sharing.</p></li></ul><ul><li><p>Refs directory — A folder that contains all of the configurations of every tag/branch of the repository.</p></li><li><p>Head file — a file that serves Git in tracking the current branch, this file contains a pointer to the refs directory.</p></li><li><p>config file — the configuration file of the repository, every time we run the Git config command this file is changing.</p></li><li><p>description file — contains a description text about the repository.</p></li></ul><h3><a aria-hidden="true" class="anchor" id="cant-get-you-out-of-my-head"></a><a aria-hidden="true" class="hash-link" href="#cant-get-you-out-of-my-head">#</a>Can’t Get You Out of My Head</h3><p>All of the Git commands which synchronize the local repository and the remote repository are going through a middle station. This middle station has different names such as staging area, cache and index file.</p><p>The index file is a binary file which represents kind of a small file system which contains a pointer to different files in the working directory. The responsibility of the index file is to manage the differences between the working directory to the repository itself.</p><p>Let’s see now how all of this is actually implemented.</p><p>In the beginning of the article when we did <code>git init</code> we saw a new hidden folder named <code>.git</code> but this folder didn’t include an index file. In order to create this index file, we will use <code>git add</code>:</p><p><img src="/assets/git-internals/git-02.png" alt="contents of the hidden .git folder"/></p><p>Now we will use <code>git status</code> to see the changes:</p><p><img src="/assets/git-internals/git-03.png" alt="contents of the hidden .git folder"/></p><p>Let’s read the contents of the index file, we will use <code>xxd</code> which is a UNIX command that creates a hex dump of a given file or standard input.</p><p><img src="/assets/git-internals/git-04.png" alt="contents of the hidden .git folder"/></p><h4><a aria-hidden="true" class="anchor" id="head-file-header"></a><a aria-hidden="true" class="hash-link" href="#head-file-header">#</a>HEAD File header</h4><p>The header stars with the “DIRC” word which represents <code>dir cache</code>
Also, the header consist of 12 bytes, the structure of the header is:</p><ul><li>4 bytes of the Git version</li><li>4 bytes of the number of records in the file</li></ul><h4><a aria-hidden="true" class="anchor" id="head-file-entry"></a><a aria-hidden="true" class="hash-link" href="#head-file-entry">#</a>HEAD File entry</h4><p>After the header, we can see that we have a record for every file that we have added. Every record has the following data:</p><ul><li>8 Bytes of the file’s CTIME (inode/file change time)</li><li>8 Bytes of the file’s mtime (file modify time)</li><li>4 Bytes of the file’s device_id</li><li>4 Bytes of the file’s inode</li><li>4 Bytes of the file’s permissions</li><li>4 Bytes of the file’s users uid</li><li>4 Bytes of the file’s size</li><li>20 Bytes of the file’s object id</li><li>2 Bytes of the record’s flag state</li><li>File’s path</li></ul><p>In order to view all of those values we can also use the following Git command:
<code>git ls-files — stage — debug</code></p><p><img src="/assets/git-internals/git-05.png" alt="contents of the hidden .git folder"/></p><h4><a aria-hidden="true" class="anchor" id="git--db"></a><a aria-hidden="true" class="hash-link" href="#git--db">#</a>Git == DB</h4><p>Git is actually a data structure which stores key-value data. For every value we will add in the repository we will get a unique key with whom we could than get the value. Git uses 2 concepts in order to save the data: blobs &amp; trees.</p><h5><a aria-hidden="true" class="anchor" id="blobs"></a><a aria-hidden="true" class="hash-link" href="#blobs">#</a>Blobs</h5><p>We can use the <code>git hash-object</code> command to get the calculated key for a specified file and also to create a new object in the repository:</p><p><img src="/assets/git-internals/git-06.png" alt="contents of the hidden .git folder"/></p><p>We got SHA-1 of the object we just created which is also named “blob”. Now that we know that Git stores all different data &amp; information in key-value like data structure let’s see where it stores it:</p><p><img src="/assets/git-internals/git-07.png" alt="contents of the hidden .git folder"/></p><p>Interesting… a folder named 84 maybe connected to our SHA-1 hash which starts with the same letters? Let’s get into this folder:
<img src="/assets/git-internals/git-08.png" alt="contents of the hidden .git folder"/></p><p>Git is actually uses the 2 first characters to order the objects in the repository. For every object there is a saved Zlib file.</p><h5><a aria-hidden="true" class="anchor" id="trees"></a><a aria-hidden="true" class="hash-link" href="#trees">#</a>Trees</h5><p>As we said earlier Git uses blobs to save the state of single files. Things are becoming much more complex when we need to save the connections between those files, and a connection between a blob that represents contents to the path. In order to solve this complexity a new concept has been introduced in Git which is named Trees. Tree is another object which saves the contents alongside with the blob’s format, let’s examine the object’s format:</p><p><code>{file-mode} {object-type} {object-hash}\t{file-name}\n</code></p><p>The file-mode field is responsible for saving the permissions of every object in the tree. When Git copies the files to the working directory it needs to save the original permissions thus this information is being saved in the creation of the tree itself.</p><p>The following are the possible values for the file-mode field:</p><ul><li>040000 — for a folder</li><li>100644 — for read only file</li><li>100664 — for read/write only file</li><li>100755 — for an execution file</li><li>120000 — for a symbolic link file</li><li>160000 — for a Git link</li></ul><p>Every tree in Git can point to other trees, or in different words, a tree serves Git to represent a folder. In this way, Git represents the files &amp; folders structure by a basic tree format.</p><p>Let’s verify our understanding on this concept, we’ll create a new folder (in our current directory) and we’ll copy the <code>1.txt</code> file to it:</p><p><img src="/assets/git-internals/git-09.png" alt="contents of the hidden .git folder"/></p><p>Because we didn’t change the contents of the file, the SHA1 calculation of the file has not been changed.</p><p><code>102633 blob 352806164C31AC7F77CA29CE0F78C13D357F30B0 1.txt</code></p><p>We can also point our newly created tree to our previous tree.</p><p><code>102633 blob 352806164C31AC7F77CA29CE0F78C13D357F30B0 1.txt 100644 blob 468A779BA3D7D115B10D71ECD6FB9AC4E50B8E59 2.txt 100644 blob 28AB96C2D9620D1D4F2CC9FD74AFACB1CD16621D newfile.txt 040000 tree 6d2b647a0bb32c9e648ed130afbbfd2608427a23 internal-dir</code></p><h4><a aria-hidden="true" class="anchor" id="basics-basics-are-important"></a><a aria-hidden="true" class="hash-link" href="#basics-basics-are-important">#</a>Basics, Basics are important</h4><blockquote><p>I don’t think that the basics that kids need have changed in 10,000 years.</p></blockquote><h5><a aria-hidden="true" class="anchor" id="git-add"></a><a aria-hidden="true" class="hash-link" href="#git-add">#</a>Git add</h5><p>When we run the <code>git add</code> command 2 things are happening behind the scenes:</p><ul><li><p>New objects are being created in the objects directory which represent the contents we just add — blobs for files and trees for directories.</p></li><li><p>New metadata that points to those created objects is being written to the index file.</p></li></ul><p>When we don’t add new files but only change the contents of given files — Git still goes through those 2 phases. As we said earlier, Git doesn’t care what is the change that has been done to the file — it just calculates SHA-1 based on the contents of the file.</p><h5><a aria-hidden="true" class="anchor" id="git-commit"></a><a aria-hidden="true" class="hash-link" href="#git-commit">#</a>Git commit</h5><p>Git is basically a wrapper on top of the trees concept. Let’s understand this, When we run <code>git commit</code>, Git is building a new tree object from the information that is being stored in the index file and saves the object to the objects directory.</p><p>Let’s see this in action:</p><p><img src="/assets/git-internals/git-10.png" alt="contents of the hidden .git folder"/></p><p>We can see that a new object of type commit has been created, every objects contains the following data:</p><ul><li>The Tree’s object id</li><li>Information about the commit author</li><li>GPG commit signature</li><li>Commit message</li></ul><p>The calculated SHA-1 to the commit object is actually the commit ID we’re already familiar with:</p><p><img src="/assets/git-internals/git-11.png" alt="contents of the hidden .git folder"/></p><h5><a aria-hidden="true" class="anchor" id="git-log"></a><a aria-hidden="true" class="hash-link" href="#git-log">#</a>Git log</h5><p><code>git log</code> helps us in viewing the whole repository history, or in other words the commits objects relations.</p><p>Let’s create a new commit:
<img src="/assets/git-internals/git-12.png" alt="contents of the hidden .git folder"/></p><p>After we have created a new commit, an object with the same ID has been created. The tree of that commit points to the same files but on a new blob for the file we just changed. The difference between the old commit object is the parent field, which points to the old commit object. Meaning, by a set of commits we can create history logs:</p><p><img src="/assets/git-internals/git-13.png" alt="contents of the hidden .git folder"/></p><h4><a aria-hidden="true" class="anchor" id="how-git-knows-what-is-the-working-directory"></a><a aria-hidden="true" class="hash-link" href="#how-git-knows-what-is-the-working-directory">#</a>How git knows what is the working directory?</h4><p>In Git we can go back in time, in order to go back in Git we’ll use the <code>git checkout</code> command. As you can already understand by using <code>git checkout</code> Git replaces the commit object and the contents of the index file. So how Git knows where we are now? It uses the .git/HEAD file</p><p><img src="/assets/git-internals/git-14.png" alt="contents of the hidden .git folder"/></p><p>In this example we have seen how <code>git checkout</code> replaces the contents of the files and the .git/HEAD file which points to the current commit.</p><p>Let’s try now to use <code>git checkout</code> with branches</p><p><img src="/assets/git-internals/git-15.png" alt="contents of the hidden .git folder"/></p><p>We’ve changed the branch to master, which points to the same commit exactly. Behind the scenes we can see that the value that is written in the HEAD file changed from the value of the commit to the path of a file that matches the master branch. The contents of that path is exactly the same commit we’ve already saw in the previous step.</p><h5><a aria-hidden="true" class="anchor" id="git-branch"></a><a aria-hidden="true" class="hash-link" href="#git-branch">#</a>Git branch</h5><p>In the same way that the master points to the a specific commit, in every branch creation a new file is being created with the contents of a SHA1 encoded file, let’s examine this:</p><p><img src="/assets/git-internals/git-16.png" alt="contents of the hidden .git folder"/></p><p>Because <code>branch1</code> is not inside master, they are pointing to the same commit object.</p><h4><a aria-hidden="true" class="anchor" id="summary"></a><a aria-hidden="true" class="hash-link" href="#summary">#</a>Summary</h4><p>In this article we learned how different git commands work behind the scenes. We learned about the index file, it’s purpose, format and how it serves Git. Than, we learned about the building blocks of Git — trees &amp; blobs — their contents &amp; usage.</p><p>You can be an expert in Git without having this knowledge, but I’m sure that this knowledge will help you play with Git with more confidence.</p><p><img src="/assets/git-internals/footer.png" alt="contents of the hidden .git folder"/></p></article><div class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/git">git</a><a class="margin-horiz--sm" href="/blog/tags/internals">internals</a></div><div class="col text--right"></div></div></div><div class="margin-vert--xl"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/dive-deep-into-ast"><h5 class="pagination-nav__link--sublabel">Previous Post</h5><h4 class="pagination-nav__link--label">« <!-- -->Dive deep into AST</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div></div></main><footer class="footer footer--dark"><div class="container"><div class="text--center">Copyright © 2020 internals.dev </div></div></footer>
</div>

<script type="text/javascript" src="/runtime~main.d47d1cab049f55c88d75.js"></script>

<script type="text/javascript" src="/main.6ce7aa9963deee7ee6a8.js"></script>

<script type="text/javascript" src="/common.06bf67d2deb15cea9e38.js"></script>

<script type="text/javascript" src="/1.fe8945358b37b741bfd1.js"></script>

<script type="text/javascript" src="/component---theme-blog-post-pageccc-cab.f1186a1edfdf501c30c8.js"></script>

<script type="text/javascript" src="/content---blog-git-internalse-44-e34.3c82f465f6872ef80b5c.js"></script>

<script type="text/javascript" src="/nextItem---blog-dive-deep-into-asteef-c4b.7736a0a4a4ba9c8c78eb.js"></script>

<script type="text/javascript" src="/metadata---blog-dive-deep-into-astdcf-78c.ef3efba524e487d5fa12.js"></script>

</body>
</html>