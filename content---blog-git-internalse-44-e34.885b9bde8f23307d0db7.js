(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{143:function(e,t,i){"use strict";i.r(t),i.d(t,"frontMatter",(function(){return o})),i.d(t,"rightToc",(function(){return l})),i.d(t,"default",(function(){return c}));i(58),i(31),i(22),i(23),i(59),i(0);var n=i(167);function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var o={id:"git-internals",title:"Git Internals",author:"Zohar Yzgeav",authorTitle:"Code Enthusiast",authorURL:"https://github.com/zoharyzgiaev",authorImageURL:"https://avatars1.githubusercontent.com/u/43813108?s=460&v=4",keywords:["git","internals"],tags:["git","internals"],image:"https://i.imgur.com/mErPwqL.png"},l=[{value:"It all starts from the basics",id:"it-all-starts-from-the-basics",children:[]},{value:"Can\u2019t Get You Out of My Head",id:"cant-get-you-out-of-my-head",children:[]}],s={rightToc:l},r="wrapper";function c(e){var t=e.components,i=function(e,t){if(null==e)return{};var i,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,["components"]);return Object(n.b)(r,a({},s,i,{components:t,mdxType:"MDXLayout"}),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/header.jpeg",alt:"alt-text"}))),Object(n.b)("p",null,"Who doesn\u2019t know Git? Most of us are probably using Git or some other source control tool in our everyday life. In this article I will explain how Git works behind the scenes, we\u2019ll dive into the HEAD file, how different Git flow commands work and will explore different Git terminologies. This knowledge will not only improve our Git capabilities but will also introduce deep understanding which will help us build different products in our future career."),Object(n.b)("p",null,"In this article I assume you have basic understanding of what Git is, how is it different from other source control tools and that you have used basic git before."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Disclaimer"),": This article is intended for people who want to expand their knowledge in \u2018git-internals\u2019 which is a wide topic to understand Git behind the scenes, you won\u2019t learn how to use different git command in this article but rather how they work."),Object(n.b)("h3",{id:"it-all-starts-from-the-basics"},"It all starts from the basics"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/push-meme.png",alt:"alt-text"}))),Object(n.b)("p",null,"In order to start hacking with Git we will need to use the\ngit init\ncommand which will create a local repository for us.\nThis command created a hidden folder with the name of .git which represents the whole repository. From now on, every Git command we will use will be affected by the hidden .git folder that has been just created."),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-01.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Let\u2019s dive into the contents of the .git folder, this folder contains different folders ","&"," files which responsible for managing your repository:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Objects directory \u2014 A folder that lists all the files history, we will talk briefly about this directory soon.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Hooks directory \u2014 A folder that contains hook scripts that can be run before/after different Git commands.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Info directory \u2014 A folder that contains the exclude file which is responsible for IDE changes, this file is similar to .gitignore but it doesn\u2019t intended for sharing."))),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Refs directory \u2014 A folder that contains all of the configurations of every tag/branch of the repository.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Head file \u2014 a file that serves Git in tracking the current branch, this file contains a pointer to the refs directory.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"config file \u2014 the configuration file of the repository, every time we run the Git config command this file is changing.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"description file \u2014 contains a description text about the repository."))),Object(n.b)("h3",{id:"cant-get-you-out-of-my-head"},"Can\u2019t Get You Out of My Head"),Object(n.b)("p",null,"All of the Git commands which synchronize the local repository and the remote repository are going through a middle station. This middle station has different names such as staging area, cache and index file."),Object(n.b)("p",null,"The index file is a binary file which represents kind of a small file system which contains a pointer to different files in the working directory. The responsibility of the index file is to manage the differences between the working directory to the repository itself."),Object(n.b)("p",null,"Let\u2019s see now how all of this is actually implemented."),Object(n.b)("p",null,"In the beginning of the article when we did ",Object(n.b)("inlineCode",{parentName:"p"},"git init")," we saw a new hidden folder named ",Object(n.b)("inlineCode",{parentName:"p"},".git")," but this folder didn\u2019t include an index file. In order to create this index file, we will use ",Object(n.b)("inlineCode",{parentName:"p"},"git add"),":"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-02.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Now we will use ",Object(n.b)("inlineCode",{parentName:"p"},"git status")," to see the changes:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-03.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Let\u2019s read the contents of the index file, we will use ",Object(n.b)("inlineCode",{parentName:"p"},"xxd")," which is a UNIX command that creates a hex dump of a given file or standard input."),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-04.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("h4",{id:"head-file-header"},"HEAD File header"),Object(n.b)("p",null,"The header stars with the \u201cDIRC\u201d word which represents ",Object(n.b)("inlineCode",{parentName:"p"},"dir cache"),"\nAlso, the header consist of 12 bytes, the structure of the header is:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"4 bytes of the Git version"),Object(n.b)("li",{parentName:"ul"},"4 bytes of the number of records in the file")),Object(n.b)("h4",{id:"head-file-entry"},"HEAD File entry"),Object(n.b)("p",null,"After the header, we can see that we have a record for every file that we have added. Every record has the following data:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"8 Bytes of the file\u2019s CTIME (inode/file change time)"),Object(n.b)("li",{parentName:"ul"},"8 Bytes of the file\u2019s mtime (file modify time)"),Object(n.b)("li",{parentName:"ul"},"4 Bytes of the file\u2019s device_id"),Object(n.b)("li",{parentName:"ul"},"4 Bytes of the file\u2019s inode"),Object(n.b)("li",{parentName:"ul"},"4 Bytes of the file\u2019s permissions"),Object(n.b)("li",{parentName:"ul"},"4 Bytes of the file\u2019s users uid"),Object(n.b)("li",{parentName:"ul"},"4 Bytes of the file\u2019s size"),Object(n.b)("li",{parentName:"ul"},"20 Bytes of the file\u2019s object id"),Object(n.b)("li",{parentName:"ul"},"2 Bytes of the record\u2019s flag state"),Object(n.b)("li",{parentName:"ul"},"File\u2019s path")),Object(n.b)("p",null,"In order to view all of those values we can also use the following Git command:\n",Object(n.b)("inlineCode",{parentName:"p"},"git ls-files \u2014 stage \u2014 debug")),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-05.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("h4",{id:"git--db"},"Git == DB"),Object(n.b)("p",null,"Git is actually a data structure which stores key-value data. For every value we will add in the repository we will get a unique key with whom we could than get the value. Git uses 2 concepts in order to save the data: blobs & trees."),Object(n.b)("h5",{id:"blobs"},"Blobs"),Object(n.b)("p",null,"We can use the ",Object(n.b)("inlineCode",{parentName:"p"},"git hash-object")," command to get the calculated key for a specified file and also to create a new object in the repository:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-06.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"We got SHA-1 of the object we just created which is also named \u201cblob\u201d. Now that we know that Git stores all different data & information in key-value like data structure let\u2019s see where it stores it:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-07.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Interesting\u2026 a folder named 84 maybe connected to our SHA-1 hash which starts with the same letters? Let\u2019s get into this folder:\n",Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-08.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Git is actually uses the 2 first characters to order the objects in the repository. For every object there is a saved Zlib file."),Object(n.b)("h5",{id:"trees"},"Trees"),Object(n.b)("p",null,"As we said earlier Git uses blobs to save the state of single files. Things are becoming much more complex when we need to save the connections between those files, and a connection between a blob that represents contents to the path. In order to solve this complexity a new concept has been introduced in Git which is named Trees. Tree is another object which saves the contents alongside with the blob\u2019s format, let\u2019s examine the object\u2019s format:"),Object(n.b)("p",null,Object(n.b)("inlineCode",{parentName:"p"},"{file-mode} {object-type} {object-hash}\\t{file-name}\\n")),Object(n.b)("p",null,"The file-mode field is responsible for saving the permissions of every object in the tree. When Git copies the files to the working directory it needs to save the original permissions thus this information is being saved in the creation of the tree itself."),Object(n.b)("p",null,"The following are the possible values for the file-mode field:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"040000 \u2014 for a folder"),Object(n.b)("li",{parentName:"ul"},"100644 \u2014 for read only file"),Object(n.b)("li",{parentName:"ul"},"100664 \u2014 for read/write only file"),Object(n.b)("li",{parentName:"ul"},"100755 \u2014 for an execution file"),Object(n.b)("li",{parentName:"ul"},"120000 \u2014 for a symbolic link file"),Object(n.b)("li",{parentName:"ul"},"160000 \u2014 for a Git link")),Object(n.b)("p",null,"Every tree in Git can point to other trees, or in different words, a tree serves Git to represent a folder. In this way, Git represents the files & folders structure by a basic tree format."),Object(n.b)("p",null,"Let\u2019s verify our understanding on this concept, we\u2019ll create a new folder (in our current directory) and we\u2019ll copy the ",Object(n.b)("inlineCode",{parentName:"p"},"1.txt")," file to it:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-09.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Because we didn\u2019t change the contents of the file, the SHA1 calculation of the file has not been changed."),Object(n.b)("p",null,Object(n.b)("inlineCode",{parentName:"p"},"102633 blob 352806164C31AC7F77CA29CE0F78C13D357F30B0 1.txt")),Object(n.b)("p",null,"We can also point our newly created tree to our previous tree."),Object(n.b)("p",null,Object(n.b)("inlineCode",{parentName:"p"},"102633 blob 352806164C31AC7F77CA29CE0F78C13D357F30B0 1.txt 100644 blob 468A779BA3D7D115B10D71ECD6FB9AC4E50B8E59 2.txt 100644 blob 28AB96C2D9620D1D4F2CC9FD74AFACB1CD16621D newfile.txt 040000 tree 6d2b647a0bb32c9e648ed130afbbfd2608427a23 internal-dir")),Object(n.b)("h4",{id:"basics-basics-are-important"},"Basics, Basics are important"),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"I don\u2019t think that the basics that kids need have changed in 10,000 years.")),Object(n.b)("h5",{id:"git-add"},"Git add"),Object(n.b)("p",null,"When we run the ",Object(n.b)("inlineCode",{parentName:"p"},"git add")," command 2 things are happening behind the scenes:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"New objects are being created in the objects directory which represent the contents we just add \u2014 blobs for files and trees for directories.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"New metadata that points to those created objects is being written to the index file."))),Object(n.b)("p",null,"When we don\u2019t add new files but only change the contents of given files \u2014 Git still goes through those 2 phases. As we said earlier, Git doesn\u2019t care what is the change that has been done to the file \u2014 it just calculates SHA-1 based on the contents of the file."),Object(n.b)("h5",{id:"git-commit"},"Git commit"),Object(n.b)("p",null,"Git is basically a wrapper on top of the trees concept. Let\u2019s understand this, When we run ",Object(n.b)("inlineCode",{parentName:"p"},"git commit"),", Git is building a new tree object from the information that is being stored in the index file and saves the object to the objects directory."),Object(n.b)("p",null,"Let\u2019s see this in action:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-10.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"We can see that a new object of type commit has been created, every objects contains the following data:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"The Tree\u2019s object id"),Object(n.b)("li",{parentName:"ul"},"Information about the commit author"),Object(n.b)("li",{parentName:"ul"},"GPG commit signature"),Object(n.b)("li",{parentName:"ul"},"Commit message")),Object(n.b)("p",null,"The calculated SHA-1 to the commit object is actually the commit ID we\u2019re already familiar with:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-11.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("h5",{id:"git-log"},"Git log"),Object(n.b)("p",null,Object(n.b)("inlineCode",{parentName:"p"},"git log")," helps us in viewing the whole repository history, or in other words the commits objects relations."),Object(n.b)("p",null,"Let\u2019s create a new commit:\n",Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-12.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"After we have created a new commit, an object with the same ID has been created. The tree of that commit points to the same files but on a new blob for the file we just changed. The difference between the old commit object is the parent field, which points to the old commit object. Meaning, by a set of commits we can create history logs:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-13.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("h4",{id:"how-git-knows-what-is-the-working-directory"},"How git knows what is the working directory?"),Object(n.b)("p",null,"In Git we can go back in time, in order to go back in Git we\u2019ll use the ",Object(n.b)("inlineCode",{parentName:"p"},"git checkout")," command. As you can already understand by using ",Object(n.b)("inlineCode",{parentName:"p"},"git checkout")," Git replaces the commit object and the contents of the index file. So how Git knows where we are now? It uses the .git/HEAD file"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-14.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"In this example we have seen how ",Object(n.b)("inlineCode",{parentName:"p"},"git checkout")," replaces the contents of the files and the .git/HEAD file which points to the current commit."),Object(n.b)("p",null,"Let\u2019s try now to use ",Object(n.b)("inlineCode",{parentName:"p"},"git checkout")," with branches"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-15.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"We\u2019ve changed the branch to master, which points to the same commit exactly. Behind the scenes we can see that the value that is written in the HEAD file changed from the value of the commit to the path of a file that matches the master branch. The contents of that path is exactly the same commit we\u2019ve already saw in the previous step."),Object(n.b)("h5",{id:"git-branch"},"Git branch"),Object(n.b)("p",null,"In the same way that the master points to the a specific commit, in every branch creation a new file is being created with the contents of a SHA1 encoded file, let\u2019s examine this:"),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/git-16.png",alt:"contents of the hidden .git folder"}))),Object(n.b)("p",null,"Because ",Object(n.b)("inlineCode",{parentName:"p"},"branch1")," is not inside master, they are pointing to the same commit object."),Object(n.b)("h4",{id:"summary"},"Summary"),Object(n.b)("p",null,"In this article we learned how different git commands work behind the scenes. We learned about the index file, it\u2019s purpose, format and how it serves Git. Than, we learned about the building blocks of Git \u2014 trees & blobs \u2014 their contents & usage."),Object(n.b)("p",null,"You can be an expert in Git without having this knowledge, but I\u2019m sure that this knowledge will help you play with Git with more confidence."),Object(n.b)("p",null,Object(n.b)("img",a({parentName:"p"},{src:"assets/git-internals/footer.png",alt:"contents of the hidden .git folder"}))))}c.isMDXComponent=!0}}]);